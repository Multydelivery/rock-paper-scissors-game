<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock Paper Scissors - Pure Python</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <link rel="stylesheet" href="style.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ Rock Paper Scissors üéÆ</h1>
            <p class="python-badge">üêç Powered by Pure Python</p>
            <div class="score">
                <div class="score-item">
                    <span class="score-label">You</span>
                    <span class="score-value" id="player-score">0</span>
                </div>
                <div class="score-item">
                    <span class="score-label">Computer</span>
                    <span class="score-value" id="computer-score">0</span>
                </div>
            </div>
        </header>

        <main>
            <div class="game-area">
                <div class="choices">
                    <h2>Choose your weapon:</h2>
                    <div class="choice-buttons">
                        <button class="choice-btn" onclick="playGameSync('rock')" id="rock-btn">
                            <span class="emoji">ü™®</span>
                            <span class="label">Rock</span>
                        </button>
                        <button class="choice-btn" onclick="playGameSync('paper')" id="paper-btn">
                            <span class="emoji">üìÑ</span>
                            <span class="label">Paper</span>
                        </button>
                        <button class="choice-btn" onclick="playGameSync('scissors')" id="scissors-btn">
                            <span class="emoji">‚úÇÔ∏è</span>
                            <span class="label">Scissors</span>
                        </button>
                    </div>
                </div>

                <div class="battle-area" id="battle-area" style="display: none;">
                    <div class="player-choice">
                        <h3>You chose:</h3>
                        <div class="choice-display" id="player-display">
                            <span class="emoji" id="player-emoji"></span>
                            <span class="label" id="player-label"></span>
                        </div>
                    </div>
                    
                    <div class="vs">VS</div>
                    
                    <div class="computer-choice">
                        <h3>Computer chose:</h3>
                        <div class="choice-display" id="computer-display">
                            <span class="emoji" id="computer-emoji"></span>
                            <span class="label" id="computer-label"></span>
                        </div>
                    </div>
                </div>

                <div class="result-area" id="result-area" style="display: none;">
                    <div class="result-message" id="result-message"></div>
                    <button class="play-again-btn" onclick="resetRound()" id="play-again">Play Again</button>
                </div>
            </div>
        </main>

        <footer>
            <button class="reset-btn" onclick="resetGame()" id="reset-game">Reset Game</button>
            <div class="loading-indicator" id="loading" style="display: none;">
                <span>üêç Loading Python...</span>
            </div>
        </footer>
    </div>

    <py-script>
        import random
        from js import document, console, setTimeout, window
        from pyodide.ffi import create_proxy

        # Your original Python logic - completely unchanged!
        def normalize_choice(s):
            s = s.strip().lower()
            if s.startswith('r'):
                return 'rock'
            if s.startswith('p'):
                return 'paper'
            if s.startswith('s'):
                return 'scissors'
            raise ValueError(f"Invalid choice: {s}")

        def random_choice():
            return random.choice(['rock', 'paper', 'scissors'])

        def decide(player, computer):
            """Decide winner. Returns one of: 'win', 'lose', 'draw'."""
            if player == computer:
                return 'draw'
            wins = {
                ('rock', 'scissors'),
                ('scissors', 'paper'),
                ('paper', 'rock'),
            }
            return 'win' if (player, computer) in wins else 'lose'

        def play_round(player_input):
            """Play one round given raw player input.
            Returns tuple (player_choice, computer_choice, result)"""
            player = normalize_choice(player_input)
            comp = random_choice()
            result = decide(player, comp)
            return player, comp, result

        # Game state
        class GameState:
            def __init__(self):
                self.player_score = 0
                self.computer_score = 0
                self.choices = {
                    'rock': {'emoji': 'ü™®', 'label': 'Rock'},
                    'paper': {'emoji': 'üìÑ', 'label': 'Paper'},
                    'scissors': {'emoji': '‚úÇÔ∏è', 'label': 'Scissors'}
                }

        game = GameState()

        def update_score_display():
            document.getElementById("player-score").innerHTML = str(game.player_score)
            document.getElementById("computer-score").innerHTML = str(game.computer_score)

        def show_choice(player_type, choice):
            choice_data = game.choices[choice]
            emoji_id = f"{player_type}-emoji"
            label_id = f"{player_type}-label"
            
            document.getElementById(emoji_id).innerHTML = choice_data['emoji']
            document.getElementById(label_id).innerHTML = choice_data['label']

        def show_result(result):
            document.getElementById("result-area").style.display = "block"
            
            if result == 'win':
                message = 'üéâ You Win! üéâ'
                class_name = 'result-message win'
                game.player_score += 1
            elif result == 'lose':
                message = 'üíª Computer Wins! üíª'
                class_name = 'result-message lose'
                game.computer_score += 1
            else:
                message = 'ü§ù It\'s a Draw! ü§ù'
                class_name = 'result-message draw'
            
            result_elem = document.getElementById("result-message")
            result_elem.innerHTML = message
            result_elem.className = class_name
            
            update_score_display()

        def play_game_sync(choice):
            # Disable buttons during game
            for btn_id in ['rock-btn', 'paper-btn', 'scissors-btn']:
                document.getElementById(btn_id).disabled = True
            
            # Show battle area
            document.getElementById("battle-area").style.display = "flex"
            document.getElementById("result-area").style.display = "none"
            
            # Show player choice immediately
            show_choice('player', choice)
            
            # Show computer "thinking" briefly
            document.getElementById("computer-emoji").innerHTML = 'ü§î'
            document.getElementById("computer-label").innerHTML = 'Thinking...'
            
            # Use setTimeout for a brief delay
            def delayed_result():
                try:
                    player_choice, computer_choice, result = play_round(choice)
                    
                    # Show computer choice
                    show_choice('computer', computer_choice)
                    
                    # Show result
                    show_result(result)
                    
                except ValueError as e:
                    document.getElementById("result-message").innerHTML = f"Error: {e}"
                    document.getElementById("result-area").style.display = "block"
                
                # Re-enable buttons
                for btn_id in ['rock-btn', 'paper-btn', 'scissors-btn']:
                    document.getElementById(btn_id).disabled = False
            
            # Add small delay for effect
            from js import setTimeout
            setTimeout(create_proxy(delayed_result), 800)

        def reset_round():
            document.getElementById("battle-area").style.display = "none"
            document.getElementById("result-area").style.display = "none"
            
            # Clear previous choices
            for elem_id in ['player-emoji', 'player-label', 'computer-emoji', 'computer-label']:
                document.getElementById(elem_id).innerHTML = ''

        def reset_game():
            game.player_score = 0
            game.computer_score = 0
            update_score_display()
            reset_round()

        # Initialize display
        update_score_display()

        # Expose functions to global scope for onclick handlers
        from js import window
        window.playGameSync = create_proxy(play_game_sync)
        window.resetRound = create_proxy(reset_round)
        window.resetGame = create_proxy(reset_game)

        # Add keyboard shortcuts
        def handle_keydown(event):
            key_map = {
                'r': 'rock',
                'p': 'paper', 
                's': 'scissors'
            }
            
            key = event.key.lower()
            if key in key_map:
                choice = key_map[key]
                play_game_sync(choice)
            elif key == 'escape':
                reset_game()

        # Bind keyboard events  
        keydown_proxy = create_proxy(handle_keydown)
        document.addEventListener('keydown', keydown_proxy)

        console.log("üêç Pure Python Rock-Paper-Scissors loaded successfully!")
    </py-script>
</body>
</html>